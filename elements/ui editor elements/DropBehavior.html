<style>
	[draggable] {
		-moz-user-select: none;
		-khtml-user-select: none;
		-webkit-user-select: none;
		user-select: none;
	}
	
	.acceptingContainer {
		border-radius: 5px;
		box-shadow: inset 0 0 10px #95FF68;
	}
			
	.refusingContainer {
		border-radius: 5px;
		box-shadow: inset 0 0 10px #FF6868;
	}
</style>
<script>
	DropBehavior = {

		properties: {
            // structure
            structure:
            {
                type: Object,
                notify: true,
                //readOnly: true,
                value:{
                    "id": "",
                    "is": "",
                    "config": { "displayedText": "ooo"},
                    "children": {}
                }
            },

            /* UI configuration */
            // id
            id:
            {
                type: String,
                value: 'no ID',
                notify: true,
                reflectToAttribute: true,
                observer: 'oo'
            },
		
            // Unique children Id reference
			divUniqueID:
			{
                type: Number,
				value: 0
			},
            
            hostRef: ""
			
		},

		listeners: {
			dragover: 'UIdragOver',
			dragleave: 'UIdragLeave',
			drop: 'UIdrop'
		},
		
		UIdragLeave: function (ev) {
		
			ev.stopPropagation();
			ev.preventDefault();
			
			this.toggleClass("acceptingContainer", 0, this.$.blockContainer);
			this.toggleClass("refusingContainer", 0, this.$.blockContainer);
		},

		UIdragOver: function (ev) {	
			
			this.sendToasterMsgDisplayRequest("you can drop it here", "information");
			
			ev.stopPropagation();
			ev.preventDefault();
			
			this.toggleClass("acceptingContainer", 1, this.$.blockContainer);
		},
		
		UIdrop: function(ev) {
			console.log("----------------------");
			console.log("UIdrop ext behaviour");
			
			ev.stopPropagation();
			ev.preventDefault();
			
			var host = this,
                data = ev.dataTransfer.getData("text/html"),
				newId = this.id + "_" + this.increaseUniqueID(); /* We cannot use the same ID */
				
			//this.structure.children[newId] = {};
			
			// Remove the class "dragged" which makes the icon low opacity
			$srcObject = document.getElementById(data);
			$($srcObject).removeClass("dragged");
			
			this.toggleClass("acceptingContainer", 0, this.$.blockContainer);
			this.toggleClass("refusingContainer", 0, this.$.blockContainer);
			
			var nodeCopy = document.createElement('div', data);
            console.log(newId);
            
            nodeCopy.id = newId;
            nodeCopy.mode = "Development";
            nodeCopy.hostRef = this;
            //nodeCopy.draggable = true;
            // Not sure whether it is needed
            
            console.log(this.copyJSONobj(nodeCopy.structure));

            // test related to add event listener to dynamically added cpt (https://stackoverflow.com/questions/30685452/bind-a-value-between-a-parent-and-a-child-element-where-child-element-is-created)
            /*nodeCopy.addEventListener("structure-changed", function(e) {
                console.log("/structure-changed");
                console.log(e.target);
                console.log(this.copyJSONobj(this.structure));
                console.log(e.target.__data__.id + " vs " + newId);
                if ( e.target.__data__.id == newId) {
                    //var structure = this.copyJSONobj(e.target.__data__.structure);
                    var structure = this.copyJSONobj(this.structure);
                    console.log(structure);
                    console.log(host.structure);
                    //host.set('structure.children.' + newId, structure);
                }
            });*/
			
			Polymer.dom(this.$.container).appendChild(nodeCopy);
			this.sendToasterMsgDisplayRequest("dropped!", "information");
		},
		
        // test related to add event listener to dynamically added cpt (https://stackoverflow.com/questions/30685452/bind-a-value-between-a-parent-and-a-child-element-where-child-element-is-created)
		structureChanged: function(value) { console.log("structureChanged");},
		
		increaseUniqueID: function() { return this.divUniqueID = this.divUniqueID + 1;},
		
		sendRemoveUIChildRequest: function() { this.fire('removeUIChildRequest', { "node": this });},
        
        attached: function() {
            console.log("/attached");
            console.log(this.hostRef);
            //this.structure.is = this.is;
            this.structure.id = this.id;
            this.set('structure.is', this.is);
            // Use set to trigger the observer
            //this.set('structure.id', this.id);
        },
        
        oo: function() {
                console.log("/oo");
                console.log(this.id);
        }
    };
</script>