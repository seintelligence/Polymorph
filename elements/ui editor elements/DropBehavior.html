<style>
	[draggable] {
		-moz-user-select: none;
		-khtml-user-select: none;
		-webkit-user-select: none;
		user-select: none;
	}
	
	.acceptingContainer {
		border-radius: 5px;
		box-shadow: inset 0 0 10px #95FF68;
	}
			
	.refusingContainer {
		border-radius: 5px;
		box-shadow: inset 0 0 10px #FF6868;
	}
</style>
<script>
	DropBehavior = {

		properties: {
            // structure
            structure:
            {
                type: Object,
                notify: true,
                value:{
                    "id": "",
                    "is": "",
                    "config": {},
                    "children": {}
                }
            },

            /* UI configuration */
            // id
            id:
            {
                type: String,
                value: 'no ID',
                reflectToAttribute: true
            },
		
            // Unique children Id reference
			divUniqueID:
			{
                type: Number,
				value: 0
			},
			
			/*parentcontainer:
			{
				type: Object,
				reflectToAttribute: true
			}*/
			
		},

		listeners: {
			dragover: 'UIdragOver',
			dragleave: 'UIdragLeave',
			drop: 'UIdrop'
		},
        
        observers: [
            //'updateJsonUIstructure2(structure.*)'
        ],
		
		UIdragLeave: function (ev) {
		
			ev.stopPropagation();
			ev.preventDefault();
			
			this.toggleClass("acceptingContainer", 0, this.$.blockContainer);
			this.toggleClass("refusingContainer", 0, this.$.blockContainer);
		},

		UIdragOver: function (ev) {	
			
			this.sendToasterMsgDisplayRequest("you can drop it here", "information");
			
			ev.stopPropagation();
			ev.preventDefault();
			
			this.toggleClass("acceptingContainer", 1, this.$.blockContainer);
		},
		
		UIdrop: function(ev) {
			console.log("----------------------");
			console.log("UIdrop ext behaviour");
			
			ev.stopPropagation();
			ev.preventDefault();
			
			var host = this,
                data = ev.dataTransfer.getData("text/html"),
				newId = this.id + "_" + this.increaseUniqueID(); /* We cannot use the same ID */
				
			//this.structure.children[newId] = { 'id': newId};
			
			// Remove the class "dragged" which makes the icon low opacity
			$srcObject = document.getElementById(data);
			$($srcObject).removeClass("dragged");
			
			this.toggleClass("acceptingContainer", 0, this.$.blockContainer);
			this.toggleClass("refusingContainer", 0, this.$.blockContainer);
			
			var nodeCopy = document.createElement('div', data);
				nodeCopy.id = newId;
				nodeCopy.mode = "Development";
				//nodeCopy.draggable = true;
                // Not sure whether it is needed
				//nodeCopy.parentcontainer = this.id;
                // test related to add event listener to dynamically added cpt (https://stackoverflow.com/questions/30685452/bind-a-value-between-a-parent-and-a-child-element-where-child-element-is-created)
				nodeCopy.addEventListener("structure-changed", function(e){
                    console.log("/structure changed");
                    host.set('structure.children.' + newId, this.structure);
                    this.echoObject(host.structure);
                    console.log(host);
                });
			
			Polymer.dom(this.$.container).appendChild(nodeCopy);
			this.sendToasterMsgDisplayRequest("dropped!", "information");
		},
		
        // test related to add event listener to dynamically added cpt (https://stackoverflow.com/questions/30685452/bind-a-value-between-a-parent-and-a-child-element-where-child-element-is-created)
		structureChanged: function(value) { console.log("structureChanged");},
		
		increaseUniqueID: function() { return this.divUniqueID = this.divUniqueID + 1;},
		
		sendRemoveUIChildRequest: function() { this.fire('removeUIChildRequest', { "node": this });},
        
        attached: function() {
            console.log("/attached");
            this.echoObject(this.structure);
            this.structure.is = this.is;
            // Use set to trigger the observer
            this.set('structure.id', this.id);
        }
    };
</script>